<?xml version="1.0"?>
<config>
    <modules>
        <MOIP_Transparente>
            <version>1.0.2</version>
        </MOIP_Transparente>
    </modules>
    <global>
         <fieldsets>
            <sales_convert_quote_address>
                <fee_moip>
                    <to_order>*</to_order>
                </fee_moip>
                <base_fee_moip>
                    <to_order>*</to_order>
                </base_fee_moip>
            </sales_convert_quote_address>
            <sales_convert_quote_item>
                <fee_moip>
                    <to_order_item>*</to_order_item>
                </fee_moip>
                <base_fee_moip>
                    <to_order_item>*</to_order_item>
                </base_fee_moip>
            </sales_convert_quote_item>
        </fieldsets>
        <models>
            <transparente>
                <class>MOIP_Transparente_Model</class>
                <resourceModel>transparente_mysql4</resourceModel>
            </transparente>
            <transparente_mysql4>
                <class>MOIP_Transparente_Model_Mysql4</class>
                <entities>
                    <transparente>
                        <table>moip_transparentev2</table>
                    </transparente>
                </entities>
            </transparente_mysql4>
        </models>
        <resources>
            <transparente_setup>
                <setup>
                    <module>MOIP_Transparente</module>
                    <class>Mage_Sales_Model_Resource_Setup</class>
                </setup>
                
            </transparente_setup>
            <transparente_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </transparente_write>
            <transparente_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </transparente_read>
        </resources>
        <blocks>
            <transparente>
                <class>MOIP_Transparente_Block</class>
            </transparente>
            <sales>
                <rewrite>
                    <order_totals>MOIP_Transparente_Block_Sales_Order_Fee</order_totals>
                </rewrite>
            </sales>
            <adminhtml>
                <rewrite>
                    <sales_order_totals>MOIP_Transparente_Block_Sales_Order_Fee</sales_order_totals>
                    <sales_order_invoice_totals>MOIP_Transparente_Block_Adminhtml_Sales_Order_Invoice_Fee</sales_order_invoice_totals>
                    <sales_order_creditmemo_totals>MOIP_Transparente_Block_Adminhtml_Sales_Order_Creditmemo_Fee</sales_order_creditmemo_totals>
                </rewrite>
            </adminhtml>
        </blocks>
        <helpers>
            <transparente>
                <class>MOIP_Transparente_Helper</class>
            </transparente>
        </helpers>
        <sales>
            <quote>
                <totals>
                    <fee_moip>
                        <class>transparente/sales_quote_address_total_fee</class>
                        <after>subtotal</after>
                        <before>tax</before>
                    </fee_moip>
                </totals>
            </quote>
            <order_invoice>
                <totals>
                    <fee_moip>
                        <class>transparente/sales_order_total_invoice_fee</class>
                        <after>subtotal</after>
                        <before>tax</before>
                    </fee_moip>
                </totals>
            </order_invoice>
            <order_creditmemo>
                <totals>
                    <fee_moip>
                        <class>transparente/sales_order_total_creditmemo_fee</class>
                        <after>subtotal</after>
                        <before>tax</before>
                    </fee_moip>
                </totals>
            </order_creditmemo>
        </sales>
        <template>
            <email>
                <sales_email_order_moip_cancel translate="label" module="transparente">
                    <label>Moip - Email template for order cancellation</label>
                    <file>sales/moip/cancel.html</file>
                    <type>html</type>
                </sales_email_order_moip_cancel>
                <sales_email_order_moip_cancel_guest translate="label" module="transparente">
                    <label>Moip - Email template for order cancellation - guest</label>
                    <file>sales/moip/cancel.html</file>
                    <type>html</type>
                </sales_email_order_moip_cancel_guest>
                 <sales_email_order_moip_pending translate="label" module="transparente">
                    <label>Moip - Email template for order pending</label>
                    <file>sales/moip/pending.html</file>
                    <type>html</type>
                </sales_email_order_moip_pending>
                <sales_email_order_moip_pending_guest translate="label" module="transparente">
                    <label>Moip - Email template for order pending - guest</label>
                    <file>sales/moip/pending.html</file>
                    <type>html</type>
                </sales_email_order_moip_pending_guest>
            </email>
        </template>
        <events>
        		<catalog_product_save_after>
			        <observers>
			            <transparente>
			                <type>singleton</type>
			                <class>transparente/observer</class>
			                <method>catalog_product_save_after_plans</method>
			            </transparente>
			        </observers>
			    </catalog_product_save_after>
                <admin_system_config_changed_section_payment>
                    <observers>
                        <transparente>
                            <type>singleton</type>
                            <class>transparente/observer</class>
                            <method>changeAPP</method>
                        </transparente>
                    </observers>
                </admin_system_config_changed_section_payment>
        </events>
        <payment>
            <groups>
                <moip_transparente>Moip Transparente</moip_transparente>
            </groups>
        </payment>
    </global>
    <frontend>
        <secure_url>
            <Transparente>/Transparente/</Transparente>
        </secure_url>
        <routers>
            <transparente>
                <use>standard</use>
                <args>
                    <module>MOIP_Transparente</module>
                    <frontName>Transparente</frontName>
                </args>
            </transparente>
        </routers>
        <translate>
            <modules>
                <MOIP_Transparente>
                    <files>
                        <default>MOIP_Transparente.csv</default>
                    </files>
                </MOIP_Transparente>
            </modules>
        </translate>
        <layout>
            <updates>
                <Transparente>
                    <file>moip_transparente.xml</file>
                </Transparente>
                <sales_recurring_profile>
                    <file>moip_recurring_profile.xml</file>
                </sales_recurring_profile>
            </updates>
        </layout>
    </frontend>
    <admin>
         <routers>
            <adminhtml>
                <args>
                    <modules>
                        <statusmoip after="Mage_Adminhtml">MOIP_Transparente</statusmoip>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
    <adminhtml>
        <translate>
            <modules>
                <transparente>
                    <files>
                        <default>transparente.csv</default>
                    </files>
                </transparente>
            </modules>
        </translate>
        <layout>
            <updates>
                <transparente>
                    <file>moip_transparente.xml</file>
                </transparente>
            </updates>
        </layout>
        <events>
            <core_block_abstract_prepare_layout_before>
                <observers>
                    <transparente_core_block_abstract_prepare_layout_before>
                        <class>transparente/observer</class>
                        <method>addMassAction</method>
                    </transparente_core_block_abstract_prepare_layout_before>
                </observers>
            </core_block_abstract_prepare_layout_before>
        </events>
    </adminhtml>
    <crontab>
        <jobs>
            
            <transparente_send_onhold>
                <schedule>
                    <cron_expr>30 2 * * *</cron_expr>
                </schedule>
                <run>
                    <model>transparente/cron::setPendingNotification</model>
                </run>
            </transparente_send_onhold>
            <transparente_set_state_all>
                <schedule>
                    <cron_expr>30 3 * * *</cron_expr>
                </schedule>
                <run>
                    <model>transparente/cron::setStatusAll</model>
                </run>
            </transparente_set_state_all>
           
        </jobs>
    </crontab>
    <default>
        <payment>
            <moip_transparente_standard>
                <active>0</active>
                <log>1</log>
                <title>Envio de cobrança Moip - Admin</title>
                <model>MOIP_Transparente_Model_Standard</model>
                <type_app>fluxo</type_app>
                <type_old_app>fluxo</type_old_app>
                <apelido>NOME DA EMPRESA</apelido>
                <ambiente>producao</ambiente>
                <order_status>pending</order_status>
                <payment_action>order</payment_action>
                
                <moip_cancel>payment_moip_transparente_standard_email_cancel</moip_cancel>
            </moip_transparente_standard>
            <moip_boleto>
                <active>1</active>
                <vcmentoboleto>3</vcmentoboleto>
                <vcmentoboleto_diasuteis>1</vcmentoboleto_diasuteis>
                <model>MOIP_Transparente_Model_Method_Boleto</model>
                <title>Boleto Bancário</title>
                <min_order_total>5</min_order_total>
                <order_status>pending</order_status>
                <payment_action>order</payment_action>
                <group>moip_transparente</group>
            </moip_boleto>
            <moip_cc>
                <active>1</active>
                <model>MOIP_Transparente_Model_Method_Cc</model>
                <title>Cartão de Crédito</title>
                <parcelamento>1</parcelamento>
                <valor_minimo>5</valor_minimo>
                <parcela2>4.50</parcela2>
                <parcela3>5.00</parcela3>
                <parcela4>5.50</parcela4>
                <parcela5>6.50</parcela5>
                <parcela6>7.50</parcela6>
                <parcela7>8.50</parcela7>
                <parcela8>9.50</parcela8>
                <parcela9>10.50</parcela9>
                <parcela10>11.50</parcela10>
                <parcela11>12.00</parcela11>
                <parcela12>12.50</parcela12>              
                <parcelas_avancadas>0</parcelas_avancadas>
                <nummaxparcelamax>12</nummaxparcelamax>
                <valorminimoparcela>5</valorminimoparcela>
                <min_order_total>5</min_order_total>
                <order_status>pending</order_status>
                <payment_action>order</payment_action>
                <group>moip_transparente</group>
            </moip_cc>
            <moip_tef>
                <active>1</active>
                <vcmentotef>3</vcmentotef>
                <vcmentotef_diasuteis>1</vcmentotef_diasuteis>
                <model>MOIP_Transparente_Model_Method_Tef</model>
                <title>Débito em Conta</title>
                <vcmentoboleto>3</vcmentoboleto>
                <min_order_total>5</min_order_total>
                <order_status>pending</order_status>
                <payment_action>order</payment_action>
                <group>moip_transparente</group>
            </moip_tef>
            <moip_ccrecurring>
                <order_status>pending</order_status>
                <model>MOIP_Transparente_Model_Method_CcRecurring</model>
                <title>Cartão de Crédito Recorrente</title>
                <group>moip_transparente</group>
            </moip_ccrecurring>
            <moip_boletorecurring>
                <model>MOIP_Transparente_Model_Method_BoletoRecurring</model>
                <title>Boleto Bancário Recorrente</title>
                <group>moip_transparente</group>
            </moip_boletorecurring>
        </payment>
        <moipall>
            <config>
                <enable_jquery>1</enable_jquery>
                <enable_bootstrap>1</enable_bootstrap>
            </config>
            <success_page>
                <detalis>1</detalis>
            </success_page>
        </moipall>
        <sales_email>
            <order_moip_cancel>
                <enabled>1</enabled>
                <template>sales_email_order_moip_cancel</template>
                <guest_template>sales_email_order_moip_cancel_guest</guest_template>
                <identity>sales</identity>
                <copy_method>bcc</copy_method>
            </order_moip_cancel>
            <order_moip_pending>
                <enabled>1</enabled>
                <template>sales_email_order_moip_pending</template>
                <guest_template>sales_email_order_moip_pending_guest</guest_template>
                <identity>sales</identity>
                <copy_method>bcc</copy_method>
            </order_moip_pending>
        </sales_email>
    </default>
</config>